<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decode Simulation Viz</title>
    <style>
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: sans-serif; }
        #container { display: flex; flex: 1; overflow: hidden; }
        #canvas-container { flex: 2; position: relative; background: #222; }
        #sidebar { flex: 1; display: flex; flex-direction: column; background: #eee; border-left: 1px solid #ccc; padding: 10px; overflow-y: auto; max-width: 400px; }
        .chart-container { height: 200px; width: 100%; margin-bottom: 20px; }
        #controls { padding: 10px; background: #ddd; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        #display-toggles { display: flex; flex-wrap: wrap; gap: 10px; font-size: 0.9em; }
        #display-toggles label { display: inline-flex; gap: 6px; align-items: center; }
        button { padding: 5px 10px; cursor: pointer; }
        #status { margin-left: auto; font-size: 0.9em; }
    </style>
    
    <!-- Import Maps Polyfill -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.154.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.154.0/examples/jsm/",
                "three/examples/jsm/": "https://unpkg.com/three@0.154.0/examples/jsm/",
                "three/examples/jsm/loaders/STLLoader": "https://unpkg.com/three@0.154.0/examples/jsm/loaders/STLLoader.js",
                "urdf-loader": "https://unpkg.com/urdf-loader@0.12.1/src/URDFLoader.js"
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>console.log("Index.html loaded");</script>
</head>
<body>
    <div id="controls">
        <button id="btn-replay">Replay</button>
        <button id="btn-live" disabled>Live</button>
        <button id="btn-play-pause">Pause</button>
        <input type="range" id="scrubber" min="0" max="100" value="0" style="flex: 1;">
        <span id="time-display">T: 0.00s</span>
        <span id="status">Disconnected</span>
        <span id="gamepad-status" style="margin-left: 10px;">ðŸŽ® No Gamepad</span>
        <span id="spindexer-debug" style="margin-left: 10px; color: #0f0; font-family: monospace; font-size: 0.85em;"></span>
        <span id="error-msg" style="color: red; font-weight: bold; margin-left: 20px;"></span>
    </div>
    <div id="container">
        <div id="canvas-container"></div>
        <div id="sidebar">
            <h3>Display</h3>
            <div id="display-toggles">
                <label><input type="checkbox" id="toggle-robot-mesh" checked>Robot mesh</label>
                <label><input type="checkbox" id="toggle-robot-point">Robot point</label>
                <label><input type="checkbox" id="toggle-path" checked>Choreo path</label>
                <label><input type="checkbox" id="toggle-mpc-target" checked>MPC target</label>
                <label><input type="checkbox" id="toggle-forces" checked>Wheel forces</label>
                <label><input type="checkbox" id="toggle-balls" checked>Balls</label>
                <label><input type="checkbox" id="toggle-error-chart" checked>Error chart</label>
            </div>
            <h3>Joints</h3>
            <div class="chart-container"><canvas id="chart-wheels"></canvas></div>
            <div class="chart-container"><canvas id="chart-mechanisms"></canvas></div>
            <h3>Robot Position</h3>
            <div class="chart-container"><canvas id="chart-pos"></canvas></div>
            <h3 id="error-chart-title">Tracking Error</h3>
            <div class="chart-container" id="error-chart-container"><canvas id="chart-error"></canvas></div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
